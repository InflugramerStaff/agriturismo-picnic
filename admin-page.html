                    <!-- Locations Page -->
                    <div id="locations-page" class="page">
                        <h2>Gestione Postazioni</h2>
                        
                        <button onclick="showAddLocationModal()" style="margin-bottom: 1rem;">Aggiungi postazione</button>
                        
                        <div id="locationsLoader" class="loader"></div>
                        <table id="locationsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Descrizione</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="locationsList"></tbody>
                        </table>
                    </div>
                    
                    <!-- Settings Page -->
                    <div id="settings-page" class="page">
                        <h2>Impostazioni</h2>
                        
                        <div class="card" style="margin-bottom: 1rem;">
                            <h3>Impostazioni generali</h3>
                            <div class="form-group">
                                <label for="siteName">Nome agriturismo:</label>
                                <input type="text" id="siteName" value="Agriturismo Picnic">
                            </div>
                            <div class="form-group">
                                <label for="siteDescription">Descrizione:</label>
                                <textarea id="siteDescription" rows="3">Il miglior agriturismo della zona con servizio picnic.</textarea>
                            </div>
                            <div class="form-group">
                                <label for="sitePhone">Telefono:</label>
                                <input type="text" id="sitePhone" value="+39 123 456 7890">
                            </div>
                            <div class="form-group">
                                <label for="siteEmail">Email:</label>
                                <input type="email" id="siteEmail" value="info@agriturismopicnic.it">
                            </div>
                            <button onclick="saveSettings()">Salva impostazioni</button>
                        </div>
                        
                        <div class="card">
                            <h3>Cambia password</h3>
                            <div class="form-group">
                                <label for="currentPassword">Password attuale:</label>
                                <input type="password" id="currentPassword">
                            </div>
                            <div class="form-group">
                                <label for="newPassword">Nuova password:</label>
                                <input type="password" id="newPassword">
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Conferma password:</label>
                                <input type="password" id="confirmPassword">
                            </div>
                            <button onclick="changePassword()">Cambia password</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Aggiungi prodotto</h3>
                <button class="close-btn" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <div class="form-group">
                <label for="productName">Nome prodotto:</label>
                <input type="text" id="productName" placeholder="Nome del prodotto">
            </div>
            <div class="form-group">
                <label for="productDescription">Descrizione:</label>
                <textarea id="productDescription" rows="3" placeholder="Descrizione del prodotto"></textarea>
            </div>
            <div class="form-group">
                <label for="productPrice">Prezzo (‚Ç¨):</label>
                <input type="number" id="productPrice" step="0.01" placeholder="0.00">
            </div>
            <div class="form-group">
                <label for="productQuantity">Quantit√† disponibile:</label>
                <input type="number" id="productQuantity" placeholder="0">
            </div>
            <div class="form-group">
                <label for="productCategory">Categoria:</label>
                <select id="productCategory">
                    <option value="Antipasti">Antipasti</option>
                    <option value="Primi">Primi</option>
                    <option value="Secondi">Secondi</option>
                    <option value="Dolci">Dolci</option>
                    <option value="Bevande">Bevande</option>
                </select>
            </div>
            <div class="form-group">
                <label for="productImage">URL Immagine:</label>
                <input type="text" id="productImage" placeholder="https://esempio.com/immagine.jpg">
            </div>
            <input type="hidden" id="productId">
            <button id="saveProductBtn" onclick="saveProduct()">Salva prodotto</button>
        </div>
    </div>
    
    <!-- Add Location Modal -->
    <div id="addLocationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="locationModalTitle">Aggiungi postazione</h3>
                <button class="close-btn" onclick="closeModal('addLocationModal')">&times;</button>
            </div>
            <div class="form-group">
                <label for="locationName">Nome postazione:</label>
                <input type="text" id="locationName" placeholder="Nome della postazione">
            </div>
            <div class="form-group">
                <label for="locationDescription">Descrizione:</label>
                <textarea id="locationDescription" rows="3" placeholder="Descrizione della postazione"></textarea>
            </div>
            <input type="hidden" id="locationId">
            <button id="saveLocationBtn" onclick="saveLocation()">Salva postazione</button>
        </div>
    </div>
    
    <!-- Order Details Modal -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Dettagli ordine</h3>
                <button class="close-btn" onclick="closeModal('orderDetailsModal')">&times;</button>
            </div>
            <div id="orderDetails"></div>
        </div>
    </div>
    
    <script>
        // Inserisci qui l'URL del tuo script Google Apps
        const API_URL = 'https://script.google.com/macros/s/AKfycbxIscmfmHpq114h2NWlsX2hhat_pw17JymWs9noNCdQgaiIQ90CiZ32_gYVVPLmnAz5bg/exec';
        
        // Credenziali di accesso (in produzione, sarebbe meglio gestirle sul server)
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'admin123';
        
        // Variabili globali
        let products = [];
        let orders = [];
        let locations = [];
        let currentOrdersFilter = 'all';
        let currentProductsFilter = 'all';
        
        // Funzione di login
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginError = document.getElementById('loginError');
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                document.getElementById('login').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadDashboardData();
            } else {
                loginError.textContent = 'Username o password non validi';
                loginError.style.display = 'block';
            }
        }
        
        // Funzione di logout
        function logout() {
            document.getElementById('login').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').style.display = 'none';
        }
        
        // Funzione per mostrare una pagina del dashboard
        function showPage(pageId) {
            // Nascondi tutte le pagine
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Mostra la pagina selezionata
            document.getElementById(pageId).classList.add('active');
            
            // Aggiorna la classe active nel menu
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
                
                if (link.getAttribute('onclick').includes(pageId)) {
                    link.classList.add('active');
                }
            });
            
            // Carica i dati in base alla pagina selezionata
            if (pageId === 'dashboard-page') {
                loadDashboardData();
            } else if (pageId === 'orders-page') {
                loadOrders();
            } else if (pageId === 'products-page') {
                loadProducts();
                loadCategories();
            } else if (pageId === 'locations-page') {
                loadLocations();
            }
        }
        
        // Funzione per caricare i dati della dashboard
        function loadDashboardData() {
            // Carica gli ordini recenti
            document.getElementById('recentOrdersLoader').style.display = 'block';
            document.getElementById('recentOrders').innerHTML = '';
            
            fetch(`${API_URL}?action=getOrders`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('recentOrdersLoader').style.display = 'none';
                    
                    if (data.success) {
                        orders = data.orders;
                        
                        // Aggiorna le statistiche
                        updateDashboardStats();
                        
                        // Mostra gli ultimi 5 ordini
                        const recentOrders = orders.slice(0, 5);
                        displayOrders(recentOrders, 'recentOrders');
                    } else {
                        document.getElementById('recentOrders').innerHTML = `
                            <div class="error-message">
                                Errore nel caricamento degli ordini. Riprova pi√π tardi.
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    document.getElementById('recentOrdersLoader').style.display = 'none';
                    document.getElementById('recentOrders').innerHTML = `
                        <div class="error-message">
                            Errore nel caricamento degli ordini: ${error}
                        </div>
                    `;
                });
                
            // Carica i prodotti per le statistiche
            fetch(`${API_URL}?action=getProducts`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        products = data.products;
                        updateDashboardStats();
                    }
                })
                .catch(error => {
                    console.error('Errore nel caricamento dei prodotti:', error);
                });
        }
        
        // Aggiorna le statistiche nella dashboard
        function updateDashboardStats() {
            // Calcola ordini di oggi
            const today = new Date().toISOString().split('T')[0];
            const ordersToday = orders.filter(order => order.Data.startsWith(today)).length;
            document.getElementById('ordersToday').textContent = ordersToday;
            
            // Calcola ordini in attesa
            const pendingOrders = orders.filter(order => order.Stato === 'pending').length;
            document.getElementById('pendingOrders').textContent = pendingOrders;
            
            // Calcola prodotti disponibili
            const availableProducts = products.filter(product => product.Quantita > 0).length;
            document.getElementById('availableProducts').textContent = availableProducts;
            
            // Calcola incasso totale
            const totalRevenue = orders
                .filter(order => order.Stato === 'completed')
                .reduce((total, order) => total + parseFloat(order.Totale), 0);
            document.getElementById('totalRevenue').textContent = `‚Ç¨${totalRevenue.toFixed(2)}`;
        }
        
        // Carica gli ordini
        function loadOrders() {
            document.getElementById('ordersLoader').style.display = 'block';
            document.getElementById('ordersList').innerHTML = '';
            
            fetch(`${API_URL}?action=getOrders`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('ordersLoader').style.display = 'none';
                    
                    if (data.success) {
                        orders = data.orders;
                        
                        // Filtra gli ordini
                        filterOrders(currentOrdersFilter);
                    } else {
                        document.getElementById('ordersList').innerHTML = `
                            <div class="error-message">
                                Errore nel caricamento degli ordini. Riprova pi√π tardi.
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    document.getElementById('ordersLoader').style.display = 'none';
                    document.getElementById('ordersList').innerHTML = `
                        <div class="error-message">
                            Errore nel caricamento degli ordini: ${error}
                        </div>
                    `;
                });
        }
        
        // Filtra gli ordini per stato
        function filterOrders(status) {
            currentOrdersFilter = status;
            
            // Aggiorna i bottoni di filtro
            document.querySelectorAll('#orders-page .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelector(`#orders-page .filter-btn[onclick="filterOrders('${status}')"]`).classList.add('active');
            
            // Filtra gli ordini
            let filteredOrders = [];
            
            if (status === 'all') {
                filteredOrders = [...orders];
            } else {
                filteredOrders = orders.filter(order => order.Stato === status);
            }
            
            // Ordina gli ordini (i pi√π recenti prima)
            filteredOrders.sort((a, b) => new Date(b.Data) - new Date(a.Data));
            
            // Mostra gli ordini
            displayOrders(filteredOrders, 'ordersList');
        }
        
        // Mostra gli ordini nella pagina
        function displayOrders(ordersList, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (ordersList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <p>Nessun ordine trovato</p>
                    </div>
                `;
                return;
            }
            
            ordersList.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'order-card';
                
                let statusClass = '';
                let statusText = '';
                
                switch (order.Stato) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = 'In attesa';
                        break;
                    case 'preparing':
                        statusClass = 'status-preparing';
                        statusText = 'In preparazione';
                        break;
                    case 'delivering':
                        statusClass = 'status-delivering';
                        statusText = 'In consegna';
                        break;
                    case 'completed':
                        statusClass = 'status-completed';
                        statusText = 'Completato';
                        break;
                }
                
                // Formatta la data
                const orderDate = new Date(order.Data);
                const formattedDate = orderDate.toLocaleDateString('it-IT') + ' ' + orderDate.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
                
                orderCard.innerHTML = `
                    <div class="order-header">
                        <h4>${order.ID}</h4>
                        <div class="order-status ${statusClass}">${statusText}</div>
                    </div>
                    <p><strong>Data:</strong> ${formattedDate}</p>
                    <p><strong>Cliente:</strong> ${order.NomeCliente} (${order.TelefonoCliente})</p>
                    <p><strong>Postazione:</strong> ${order.PostazioneNome}</p>
                    <p><strong>Totale:</strong> ‚Ç¨${parseFloat(order.Totale).toFixed(2)}</p>
                    <div class="status-actions">
                        <button class="status-btn" onclick="showOrderDetails('${order.ID}')">Dettagli</button>
                        <button class="status-btn" onclick="updateOrderStatus('${order.ID}', 'preparing')">In preparazione</button>
                        <button class="status-btn" onclick="updateOrderStatus('${order.ID}', 'delivering')">In consegna</button>
                        <button class="status-btn" onclick="updateOrderStatus('${order.ID}', 'completed')">Completato</button>
                    </div>
                `;
                
                container.appendChild(orderCard);
            });
        }
        
        // Mostra i dettagli di un ordine
        function showOrderDetails(orderId) {
            const order = orders.find(o => o.ID === orderId);
            
            if (order) {
                const orderDetails = document.getElementById('orderDetails');
                
                // Formatta la data
                const orderDate = new Date(order.Data);
                const formattedDate = orderDate.toLocaleDateString('it-IT') + ' ' + orderDate.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
                
                let statusClass = '';
                let statusText = '';
                
                switch (order.Stato) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = 'In attesa';
                        break;
                    case 'preparing':
                        statusClass = 'status-preparing';
                        statusText = 'In preparazione';
                        break;
                    case 'delivering':
                        statusClass = 'status-delivering';
                        statusText = 'In consegna';
                        break;
                    case 'completed':
                        statusClass = 'status-completed';
                        statusText = 'Completato';
                        break;
                }
                
                // Prepara la lista dei prodotti
                let productsHtml = '';
                let orderItems = [];
                
                try {
                    if (typeof order.Prodotti === 'string') {
                        orderItems = JSON.parse(order.Prodotti);
                    } else {
                        orderItems = order.Prodotti;
                    }
                } catch (e) {
                    console.error('Errore nel parsing dei prodotti:', e);
                    orderItems = [];
                }
                
                if (orderItems.length > 0) {
                    productsHtml = '<h4>Prodotti ordinati:</h4><ul>';
                    orderItems.forEach(item => {
                        productsHtml += `
                            <li>
                                ${item.name} x ${item.quantity} - ‚Ç¨${(item.price * item.quantity).toFixed(2)}
                            </li>
                        `;
                    });
                    productsHtml += '</ul>';
                } else {
                    productsHtml = '<p>Nessun prodotto trovato nell\'ordine.</p>';
                }
                
                orderDetails.innerHTML = `
                    <h4>Ordine ${order.ID}</h4>
                    <div class="order-status ${statusClass}" style="display: inline-block; margin-bottom: 1rem;">${statusText}</div>
                    <p><strong>Data:</strong> ${formattedDate}</p>
                    <p><strong>Cliente:</strong> ${order.NomeCliente}</p>
                    <p><strong>Telefono:</strong> ${order.TelefonoCliente}</p>
                    <p><strong>Postazione:</strong> ${order.PostazioneNome}</p>
                    ${productsHtml}
                    <p><strong>Totale:</strong> ‚Ç¨${parseFloat(order.Totale).toFixed(2)}</p>
                    ${order.Note ? `<p><strong>Note:</strong> ${order.Note}</p>` : ''}
                    <div class="status-actions" style="margin-top: 1rem;">
                        <button class="status-btn" onclick="updateOrderStatus('${order.ID}', 'pending')">In attesa</button>
                        <button class="status-btn" onclick="updateOrderStatus('${order.ID}', 'preparing')">In preparazione</button>
                        <button class="status-btn" onclick="updateOrderStatus('${order.ID}', 'delivering')">In consegna</button>
                        <button class="status-btn" onclick="updateOrderStatus('${order.ID}', 'completed')">Completato</button>
                    </div>
                `;
                
                openModal('orderDetailsModal');
            }
        }
        
        // Aggiorna lo stato di un ordine
        function updateOrderStatus(orderId, status) {
            fetch(`${API_URL}?action=updateOrderStatus&orderId=${orderId}&status=${status}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Aggiorna localmente lo stato dell'ordine
                        const orderIndex = orders.findIndex(o => o.ID === orderId);
                        if (orderIndex !== -1) {
                            orders[orderIndex].Stato = status;
                        }
                        
                        // Aggiorna la visualizzazione
                        if (document.getElementById('dashboard-page').classList.contains('active')) {
                            loadDashboardData();
                        } else if (document.getElementById('orders-page').classList.contains('active')) {
                            filterOrders(currentOrdersFilter);
                        }
                        
                        // Aggiorna i dettagli se il modal √® aperto
                        if (document.getElementById('orderDetailsModal').style.display === 'flex') {
                            showOrderDetails(orderId);
                        }
                        
                        alert('Stato dell\'ordine aggiornato con successo!');
                    } else {
                        alert(`Errore nell'aggiornamento dello stato: ${data.message}`);
                    }
                })
                .catch(error => {
                    alert(`Errore nell'aggiornamento dello stato: ${error}`);
                });
        }
        
        // Carica i prodotti
        function loadProducts() {
            document.getElementById('productsLoader').style.display = 'block';
            document.getElementById('productsList').innerHTML = '';
            
            fetch(`${API_URL}?action=getProducts`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('productsLoader').style.display = 'none';
                    
                    if (data.success) {
                        products = data.products;
                        displayProducts(products);
                    } else {
                        document.getElementById('productsList').innerHTML = `
                            <div class="error-message">
                                Errore nel caricamento dei prodotti. Riprova pi√π tardi.
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    document.getElementById('productsLoader').style.display = 'none';
                    document.getElementById('productsList').innerHTML = `
                        <div class="error-message">
                            Errore nel caricamento dei prodotti: ${error}
                        </div>
                    `;
                });
        }
        
        // Carica le categorie dei prodotti
        function loadCategories() {
            const container = document.getElementById('categoryFilters');
            container.innerHTML = '';
            
            // Filtra le categorie uniche
            const categories = [...new Set(products.map(p => p.Categoria))];
            
            // Aggiungi il filtro "Tutti"
            const allFilter = document.createElement('div');
            allFilter.className = `filter-btn ${currentProductsFilter === 'all' ? 'active' : ''}`;
            allFilter.textContent = 'Tutti';
            allFilter.onclick = () => filterProducts('all');
            container.appendChild(allFilter);
            
            // Aggiungi i filtri per categoria
            categories.forEach(category => {
                const categoryFilter = document.createElement('div');
                categoryFilter.className = `filter-btn ${currentProductsFilter === category ? 'active' : ''}`;
                categoryFilter.textContent = category;
                categoryFilter.onclick = () => filterProducts(category);
                container.appendChild(categoryFilter);
            });
        }
        
        // Filtra prodotti per categoria
        function filterProducts(category) {
            currentProductsFilter = category;
            
            // Aggiorna i bottoni di filtro
            document.querySelectorAll('#categoryFilters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
                
                if (btn.textContent === category || (btn.textContent === 'Tutti' && category === 'all')) {
                    btn.classList.add('active');
                }
            });
            
            // Filtra i prodotti
            let filteredProducts = [];
            
            if (category === 'all') {
                filteredProducts = [...products];
            } else {
                filteredProducts = products.filter(product => product.Categoria === category);
            }
            
            // Mostra i prodotti
            displayProducts(filteredProducts);
        }
        
        // Mostra i prodotti nella pagina
        function displayProducts(productsList) {
            const container = document.getElementById('productsList');
            container.innerHTML = '';
            
            if (productsList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üçΩÔ∏è</div>
                        <p>Nessun prodotto trovato</p>
                    </div>
                `;
                return;
            }
            
            productsList.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                productCard.innerHTML = `
                    <div class="product-info">
                        <img src="${product.URLImmagine || '/api/placeholder/400/300'}" alt="${product.Nome}" class="product-image">
                        <div class="product-details">
                            <h4>${product.Nome}</h4>
                            <p><strong>Prezzo:</strong> ‚Ç¨${parseFloat(product.Prezzo).toFixed(2)}</p>
                            <p><strong>Disponibilit√†:</strong> ${product.Quantita}</p>
                            <p><strong>Categoria:</strong> ${product.Categoria}</p>
                        </div>
                    </div>
                    <p>${product.Descrizione}</p>
                    <div class="product-actions">
                        <button class="btn-sm" onclick="editProduct('${product.ID}')">Modifica</button>
                        <button class="btn-sm btn-danger" onclick="deleteProduct('${product.ID}')">Elimina</button>
                    </div>
                `;
                
                container.appendChild(productCard);
            });
        }
        
        // Mostra il modal per aggiungere un prodotto
        function showAddProductModal() {
            document.getElementById('productModalTitle').textContent = 'Aggiungi prodotto';
            document.getElementById('productName').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productQuantity').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('productId').value = '';
            document.getElementById('saveProductBtn').textContent = 'Salva prodotto';
            
            openModal('addProductModal');
        }
        
        // Modifica un prodotto esistente
        function editProduct(productId) {
            const product = products.find(p => p.ID === productId);
            
            if (product) {
                document.getElementById('productModalTitle').textContent = 'Modifica prodotto';
                document.getElementById('productName').value = product.Nome;
                document.getElementById('productDescription').value = product.Descrizione;
                document.getElementById('productPrice').value = product.Prezzo;
                document.getElementById('productQuantity').value = product.Quantita;
                document.getElementById('productCategory').value = product.Categoria;
                document.getElementById('productImage').value = product.URLImmagine;
                document.getElementById('productId').value = product.ID;
                document.getElementById('saveProductBtn').textContent = 'Aggiorna prodotto';
                
                openModal('addProductModal');
            }
        }
        
        // Salva un prodotto (nuovo o aggiornato)
        function saveProduct() {
            const productId = document.getElementById('productId').value;
            const productName = document.getElementById('productName').value;
            const productDescription = document.getElementById('productDescription').value;
            const productPrice = document.getElementById('productPrice').value;
            const productQuantity = document.getElementById('productQuantity').value;
            const productCategory = document.getElementById('productCategory').value;
            const productImage = document.getElementById('productImage').value;
            
            // Validazione
            if (!productName || !productPrice || !productQuantity) {
                alert('Per favore, compila tutti i campi obbligatori.');
                return;
            }
            
            // Prepara i dati del prodotto
            const productData = {
                id: productId || null,
                name: productName,
                description: productDescription,
                price: parseFloat(productPrice),
                quantity: parseInt(productQuantity),
                category: productCategory,
                image: productImage
            };
            
            // Azione da eseguire
            const action = productId ? 'updateProduct' : 'addProduct';
            
            // Invia la richiesta al server
            fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: action,
                    ...productData
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal('addProductModal');
                    loadProducts();
                    alert(productId ? 'Prodotto aggiornato con successo!' : 'Prodotto aggiunto con successo!');
                } else {
                    alert(`Errore: ${data.message}`);
                }
            })
            .catch(error => {
                alert(`Errore: ${error}`);
            });
        }
        
        // Elimina un prodotto
        function deleteProduct(productId) {
            if (confirm('Sei sicuro di voler eliminare questo prodotto?')) {
                fetch(`${API_URL}?action=deleteProduct&productId=${productId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadProducts();
                            alert('Prodotto eliminato con successo!');
                        } else {
                            alert(`Errore nell'eliminazione del prodotto: ${data.message}`);
                        }
                    })
                    .catch(error => {
                        alert(`Errore nell'eliminazione del prodotto: ${error}`);
                    });
            }
        }
        
        // Carica le postazioni
        function loadLocations() {
            document.getElementById('locationsLoader').style.display = 'block';
            document.getElementById('locationsList').innerHTML = '';
            
            fetch(`${API_URL}?action=getLocations`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('locationsLoader').style.display = 'none';
                    
                    if (data.success) {
                        locations = data.locations;
                        displayLocations();
                    } else {
                        document.getElementById('locationsList').innerHTML = `
                            <tr>
                                <td colspan="4" class="error-message">
                                    Errore nel caricamento delle postazioni. Riprova pi√π tardi.
                                </td>
                            </tr>
                        `;
                    }
                })
                .catch(error => {
                    document.getElementById('locationsLoader').style.display = 'none';
                    document.getElementById('locationsList').innerHTML = `
                        <tr>
                            <td colspan="4" class="error-message">
                                Errore nel caricamento delle postazioni: ${error}
                            </td>
                        </tr>
                    `;
                });
        }
        
        // Mostra le postazioni nella tabella
        function displayLocations() {
            const container = document.getElementById('locationsList');
            container.innerHTML = '';
            
            if (locations.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <div class="empty-icon">üìç</div>
                            <p>Nessuna postazione trovata</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            locations.forEach(location => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${location.ID}</td>
                    <td>${location.Nome}</td>
                    <td>${location.Descrizione}</td>
                    <td>
                        <button class="btn-sm" onclick="editLocation('${location.ID}')">Modifica</button>
                        <button class="btn-sm btn-danger" onclick="deleteLocation('${location.ID}')">Elimina</button>
                    </td>
                `;
                
                container.appendChild(row);
            });
        }
        
        // Mostra il modal per aggiungere una postazione
        function showAddLocationModal() {
            document.getElementById('locationModalTitle').textContent = 'Aggiungi postazione';
            document.getElementById('locationName').value = '';
            document.getElementById('locationDescription').value = '';
            document.getElementById('locationId').value = '';
            document.getElementById('saveLocationBtn').textContent = 'Salva postazione';
            
            openModal('addLocationModal');
        }
        
        // Modifica una postazione esistente
        function editLocation(locationId) {
            const location = locations.find(l => l.ID === locationId);
            
            if (location) {
                document.getElementById('locationModalTitle').textContent = 'Modifica postazione';
                document.getElementById('locationName').value = location.Nome;
                document.getElementById('locationDescription').value = location.Descrizione;
                document.getElementById('locationId').value = location.ID;
                document.getElementById('saveLocationBtn').textContent = 'Aggiorna postazione';
                
                openModal('addLocationModal');
            }
        }
        
        // Salva una postazione (nuova o aggiornata)
        function saveLocation() {
            const locationId = document.getElementById('locationId').value;
            const locationName = document.getElementById('locationName').value;
            const locationDescription = document.getElementById('locationDescription').value;
            
            // Validazione
            if (!locationName) {
                alert('Per favore, inserisci il nome della postazione.');
                return;
            }
            
            // Prepara i dati della postazione
            const locationData = {
                id: locationId || null,
                name: locationName,
                description: locationDescription
            };
            
            // Azione da eseguire
            const action = locationId ? 'updateLocation' : 'addLocation';
            
            // Invia la richiesta al server
            fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: action,
                    ...locationData
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal('addLocationModal');
                    loadLocations();
                    alert(locationId ? 'Postazione aggiornata con successo!' : 'Postazione aggiunta con successo!');
                } else {
                    alert(`Errore: ${data.message}`);
                }
            })
            .catch(error => {
                alert(`Errore: ${error}`);
            });
        }
        
        // Elimina una postazione
        function deleteLocation(locationId) {
            if (confirm('Sei sicuro di voler eliminare questa postazione?')) {
                fetch(`${API_URL}?action=deleteLocation&locationId=${locationId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadLocations();
                            alert('Postazione eliminata con successo!');
                        } else {
                            alert(`Errore nell'eliminazione della postazione: ${data.message}`);
                        }
                    })
                    .catch(error => {
                        alert(`Errore nell'eliminazione della postazione: ${error}`);
                    });
            }
        }
        
        // Salva le impostazioni
        function saveSettings() {
            const siteName = document.getElementById('siteName').value;
            const siteDescription = document.getElementById('siteDescription').value;
            const sitePhone = document.getElementById('sitePhone').value;
            const siteEmail = document.getElementById('siteEmail').value;
            
            // Qui puoi inviare i dati al server se necessario
            
            alert('Impostazioni salvate con successo!');
        }
        
        // Cambia la password
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('Per favore, compila tutti i campi.');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Le password non coincidono.');
                return;
            }
            
            if (currentPassword !== ADMIN_PASSWORD) {
                alert('La password attuale non √® corretta.');
                return;
            }
            
            // In un'app reale, qui invieresti i dati al server
            // Per questa demo, aggiorniamo solo la variabile locale
            ADMIN_PASSWORD = newPassword;
            
            alert('Password cambiata con successo!');
            
            // Resetta i campi
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
        
        // Funzioni per i modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Chiudi i modal quando si clicca fuori dal contenuto
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
        
        // Funzione di ricerca ordini
        function searchOrders() {
            const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
            
            if (!searchTerm) {
                filterOrders(currentOrdersFilter);
                return;
            }
            
            const filteredOrders = orders.filter(order => {
                return (
                    order.ID.toLowerCase().includes(searchTerm) ||
                    order.NomeCliente.toLowerCase().includes(searchTerm) ||
                    order.TelefonoCliente.toLowerCase().includes(searchTerm) ||
                    order.PostazioneNome.toLowerCase().includes(searchTerm)
                );
            });
            
            displayOrders(filteredOrders, 'ordersList');
        }
        
        // Funzione di ricerca prodotti
        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            
            if (!searchTerm) {
                filterProducts(currentProductsFilter);
                return;
            }
            
            const filteredProducts = products.filter(product => {
                return (
                    product.Nome.toLowerCase().includes(searchTerm) ||
                    product.Descrizione.toLowerCase().includes(searchTerm) ||
                    product.Categoria.toLowerCase().includes(searchTerm)
                );
            });
            
            displayProducts(filteredProducts);
        }
    </script>
</body>
</html>
                <!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area Amministrativa - Gestione Picnic</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        header {
            background-color: #2E7D32;
            color: white;
            text-align: center;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 1rem;
        }
        
        .sidebar {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }
        
        .sidebar-menu a {
            display: block;
            padding: 0.5rem;
            color: #333;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: #e8f5e9;
            color: #2E7D32;
        }
        
        .content {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .stat-card {
            background-color: #e8f5e9;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2E7D32;
            margin: 0.5rem 0;
        }
        
        .stat-label {
            color: #555;
            font-size: 0.9rem;
        }
        
        .orders-list, .products-list {
            margin-top: 1rem;
        }
        
        .order-card, .product-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .order-header, .product-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            align-items: center;
        }
        
        .order-status {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: #ffd54f;
            color: #333;
        }
        
        .status-preparing {
            background-color: #4fc3f7;
            color: white;
        }
        
        .status-delivering {
            background-color: #ff9800;
            color: white;
        }
        
        .status-completed {
            background-color: #66bb6a;
            color: white;
        }
        
        .status-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .status-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.8rem;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .status-btn:hover {
            background-color: #e0e0e0;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background-color: #2E7D32;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        button:hover {
            background-color: #388E3C;
        }
        
        .btn-secondary {
            background-color: #757575;
        }
        
        .btn-secondary:hover {
            background-color: #616161;
        }
        
        .btn-danger {
            background-color: #e53935;
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .btn-sm {
            padding: 0.2rem 0.5rem;
            font-size: 0.8rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #333;
        }
        
        .search-container {
            margin-bottom: 1rem;
        }
        
        .search-box {
            display: flex;
            gap: 0.5rem;
        }
        
        .search-box input {
            flex: 1;
        }
        
        .filters {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .filter-btn {
            padding: 0.3rem 0.8rem;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .filter-btn.active {
            background-color: #e8f5e9;
            border-color: #66bb6a;
            color: #2E7D32;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .checkbox-label input[type="checkbox"] {
            width: auto;
        }
        
        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .product-info {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .product-details {
            flex: 1;
        }
        
        .product-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .chart-container {
            height: 300px;
            margin-bottom: 1.5rem;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2E7D32;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            color: #e53935;
            padding: 1rem;
            background-color: #ffebee;
            border-radius: 4px;
            margin: 1rem 0;
            text-align: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        th, td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .page-btn {
            padding: 0.3rem 0.8rem;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .page-btn.active {
            background-color: #2E7D32;
            color: white;
            border-color: #2E7D32;
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #757575;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .stat-cards {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="login" class="login-container">
        <h2>Accesso Area Amministrativa</h2>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Inserisci il tuo username">
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="Inserisci la tua password">
        </div>
        <button onclick="login()">Accedi</button>
        <div id="loginError" style="color: red; margin-top: 1rem; display: none;"></div>
    </div>
    
    <div id="dashboard" style="display: none;">
        <header>
            <h1>Area Amministrativa - Gestione Picnic</h1>
        </header>
        
        <div class="container">
            <div class="dashboard">
                <div class="sidebar">
                    <h3>Menu</h3>
                    <ul class="sidebar-menu">
                        <li><a href="#" class="active" onclick="showPage('dashboard-page')">Dashboard</a></li>
                        <li><a href="#" onclick="showPage('orders-page')">Ordini</a></li>
                        <li><a href="#" onclick="showPage('products-page')">Prodotti</a></li>
                        <li><a href="#" onclick="showPage('locations-page')">Postazioni</a></li>
                        <li><a href="#" onclick="showPage('settings-page')">Impostazioni</a></li>
                        <li><a href="#" onclick="logout()">Logout</a></li>
                    </ul>
                </div>
                
                <div class="content">
                    <!-- Dashboard Page -->
                    <div id="dashboard-page" class="page active">
                        <h2>Dashboard</h2>
                        
                        <div class="stat-cards">
                            <div class="stat-card">
                                <div class="stat-label">Ordini oggi</div>
                                <div class="stat-number" id="ordersToday">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Ordini in attesa</div>
                                <div class="stat-number" id="pendingOrders">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Prodotti disponibili</div>
                                <div class="stat-number" id="availableProducts">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Incasso totale</div>
                                <div class="stat-number" id="totalRevenue">‚Ç¨0</div>
                            </div>
                        </div>
                        
                        <h3>Ordini recenti</h3>
                        <div id="recentOrdersLoader" class="loader"></div>
                        <div id="recentOrders" class="orders-list"></div>
                        
                        <button onclick="showPage('orders-page')" style="margin-top: 1rem;">Vedi tutti gli ordini</button>
                    </div>
                    
                    <!-- Orders Page -->
                    <div id="orders-page" class="page">
                        <h2>Gestione Ordini</h2>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="orderSearch" placeholder="Cerca ordini...">
                                <button onclick="searchOrders()">Cerca</button>
                            </div>
                            <div class="filters">
                                <div class="filter-btn active" onclick="filterOrders('all')">Tutti</div>
                                <div class="filter-btn" onclick="filterOrders('pending')">In attesa</div>
                                <div class="filter-btn" onclick="filterOrders('preparing')">In preparazione</div>
                                <div class="filter-btn" onclick="filterOrders('delivering')">In consegna</div>
                                <div class="filter-btn" onclick="filterOrders('completed')">Completati</div>
                            </div>
                        </div>
                        
                        <div id="ordersLoader" class="loader"></div>
                        <div id="ordersList" class="orders-list"></div>
                        
                        <div class="pagination" id="ordersPagination"></div>
                    </div>
                    
                    <!-- Products Page -->
                    <div id="products-page" class="page">
                        <h2>Gestione Prodotti</h2>
                        
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="productSearch" placeholder="Cerca prodotti...">
                                <button onclick="searchProducts()">Cerca</button>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                                <div class="filters" id="categoryFilters"></div>
                                <button onclick="showAddProductModal()">Aggiungi prodotto</button>
                            </div>
                        </div>
                        
                        <div id="productsLoader" class="loader"></div>
                        <div id="productsList" class="products-list"></div>
                        
                        <div class="pagination" id="productsPagination"></div>
                    </div>
                    
                    <!-- Locations Page -->
